<!DOCTYPE html>
<html>
<head>
	<title>LazyThinker</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	
	<link rel="shortcut icon" href="./images/favicon.png?v=0" />
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

	<nav>
		<button onclick="this.parentElement.classList.toggle('closed')">Projets</button>
		<h1>Lazy<span>Thinker</span></h1>
		<ul id="projectList">
			<li><a href="#">+ Add new</a></li>
			<li class="prj"><img src="./images/bulb.svg"></li>
		</ul>

		<footer>
			Icons made by <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon"> www.flaticon.com</a>.<br/>
			Developped by BARDON Nathan - <a href="https://www.lazyfox.fr">LazyFox.fr</a>.<br/>
			Last update: 26 February, 2020.<br/>
			Neither licence nor patent are applied.
		</footer>
	</nav><!--


	--><section>
		<aside>
			<h1>Projet A</h1>
			<span style="background-color: #FFFAC9">Cat A. Mettre des couleurs de même teinte où la saturation change.
				<div>
					<span style="background-color: #FFD4C9">Sub A.1</span>
					<span style="background-color: #FFE4C9">Sub A.2</span>
				</div>
			</span>
			<span style="background-color: #E4C5F6">
				Cat B
				<div>
					<span style="background-color: #DFFCC7">
						Sub B.1
						<div>
							<span style="background-color: #acdcba">Subsub B.1.1</span>
							<span style="background-color: #C3EAF5">Subsub B.1.2</span>
							<span style="background-color: #92b9ff">Subsub B.1.3</span>
							<span style="background-color: #968cff">Subsub B.1.4</span>
						</div>
					</span>
				</div>
			</span>
			<span style="background-color: #ff5672">Cat C</span>
			<span style="background-color: #af9087">Cat D</span>
			<span style="background-color: #e06277">Cat E</span>
			<span id="add">+</span>
		</aside>
		
		<form>
			<input type="text" name="Description" placeholder="Type ideas here" autocomplete="off">

			<div class="radio" data-checked="1">
				<span onclick="this.parentElement.setAttribute('data-checked', 0)">Pas important</span>
				<span onclick="this.parentElement.setAttribute('data-checked', 1)">Normal</span>
				<span onclick="this.parentElement.setAttribute('data-checked', 2)">Très important</span>
			</div>
			<div class="radio" data-checked="1">
				<span onclick="this.parentElement.setAttribute('data-checked', 0)">Pas urgent</span>
				<span onclick="this.parentElement.setAttribute('data-checked', 1)">Normal</span>
				<span onclick="this.parentElement.setAttribute('data-checked', 2)">Très urgent</span>
			</div>
	
		</form>

		<ul id="ideaList">
			<li>
				<h3>titreuh</h3>
				<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
				tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
				quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
				consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
				cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
				proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>

				<i class="important"></i><i class="urgency"></i>
				<i class="author">Nbardon</i>
				<i class="date">26 Feb, 2020 12:09 PM</i>
			</li>


			<li>
				<h3>titreuh</h3>
				<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
				tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
				quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
				consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
				cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
				proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>

				<i class="-important"></i><i class="-urgency"></i>
				<i class="author">Nbardon</i>
				<i class="date">26 Feb, 2020 12:09 PM</i>
			</li>
		</ul>
	</section>


	<script type="text/javascript">
'use strict';
// ---------------------------------------------------------------------------------------
// Global variables
let elems = {
	prjLs: document.getElementById("projectList"),
	ideas: document.getElementById("ideaList"),
	aside: document.getElementsByTagName("section")[0].getElementsByTagName("aside")[0]
};
let projects = [];
let loader = new Image();
loader.src = "./images/bulb.svg";

// ---------------------------------------------------------------------------------------
// Added function to prototypes
  
/** Remove all children of an element.
  */
Element.prototype.empty = function() {
	while (this.children.length > 0)
		this.children[0].remove();
};

/** Remove all elements from a HTMLCollection.
  * Usefull for getElementsByTagName and getElementsByClassName.
  */
HTMLCollection.prototype.removeAll = function() {
	while (this.length > 0)
		this[0].remove();
}


// ---------------------------------------------------------------------------------------
// Sync functions

/** Click event handler for project list > a
  *
  * @arg e MouseEvent
  */
function openProject(e) {
	elems.aside.getElementsByTagName("span").removeAll();
	elems.ideas.empty();
	elems.ideas.append(loader);
}

/** Request the project list, update the nav list then restart after 10 seconds.
  */
function updateProjectList() {
	let xhr = new XMLHttpRequest();
	xhr.onreadystatechange = () => {
		if (xhr.readyState != XMLHttpRequest.DONE)
			return;

		let json;
		try {
			json = JSON.parse(xhr.responseText);
		} catch (e) {
			alert("Impossible de récupérer la liste des projets \n(Plus d'informations dans la console)");
			console.log(e);
			return;
		}

		elems.prjLs.getElementsByClassName("prj").removeAll();

		projects = [];
		json.forEach(proj => {
			projects[proj._id] = proj;

			let a = document.createElement("a");
			a.addEventListener("click", openProject);
			a.href = "#" + proj._id;
			a.innerText = proj.name;

			let li = document.createElement("li");
			li.append(a);
			li.className = "prj";

			elems.prjLs.append(li);
		});

		setTimeout(updateProjectList, 10000);
	}

	xhr.open("GET", "/api/projects/");
	xhr.send();
}
updateProjectList();

	</script>
</body>
</html>
